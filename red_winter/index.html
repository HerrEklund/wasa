<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Wasa - Red Winter</title>

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="../frameworks/jquery/jquery.ui.touch-punch.min.js"></script>

    <script src="../frameworks/bootstrap/js/bootstrap.min.js"></script>

    <!-- Bootstrap -->
    <link href="../frameworks/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../frameworks/bootstrap/css/bootswatch-darkly/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <!-- WASA -->
    <script src="../js/gui_extras.js"></script>
    <script src="../js/wasa_front.js?version=18"></script>
    <script src="../js/wasa_back.js?version=18"></script>
    <script src="../js/wasa_components.js?version=1"></script>

    <link rel="stylesheet" href="../css/gui_extras.css">
    <link rel="stylesheet" href="../css/wasa.css">

    <!-- Game specific component list -->
    <script src="components.js?version=1"></script>

    <style>

        #game_board {
            background-image: url('../img/red_winter/vassal/Red_Winter_Map-150.jpg');
            /*background-image: url('../img/red_winter/Red_Winter_Map_50perc.jpg'); */
            height: 5100px;
            width: 3300px;
            position: relative;
            background-size:100%;
            background-repeat: no-repeat;
            background-color: inherit;
            border: #111 4px solid;
        }

        .RW_component_50perc {
            width: 39px;
            height: 39px;
            background-size: 100%;
        }
        .RW_component {
            width: 78px;
            height: 78px;
            background-size: 100%;

            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            border: 1px solid black;
            box-shadow: 4px 4px 4px #111;
        }

    </style>

</head>

<body class="container-fluid">

    <script type="application/javascript">

        // Set from splash screen
        var GAME_ID='RedW_TEST';

        var wasa_client;
        var wasa_backend_host = '88.99.168.32';
        var wasa_backend_port = '7379';

        var animate_transformation = false;
        var animate_duration = 0;

        // Don't enable both rotation with stack selection on click
        var enable_component_rotation = false;
        var enable_stack_selection = true;

        var component_id = 0;
        var username = 'Guest';
        var game_id = 'foobar';

        // Default values
        var direct_lineup_box_on_double_click = true;

        // From wasa_components.js, assumes a component_list is present
        var component_path_prefix = '..\/img\/red_winter\/vassal\/';

        $(document).ready( function() {

            createComponentsForTray(component_list, component_path_prefix, 'main_tray');

            $('#game_id_header').innerHTML = GAME_ID;

            wasa_client = new WasaClient(wasa_backend_host, wasa_backend_port, GAME_ID, username, game_event_notification_handler, game_event_handler);

            init_wasa_front();

            /**
             *
             * This piece may be a bit application specific
             *
             *   Load all events is a good start to get the player to the front, but there is room
             *   for a custom start here. Depending on supplied keys etc,
             *      - observer or player?
             *      - setup new scenario or continue?
            */
            wasa_client.load_all_events(function () {
                // Slow down animations after all existing elements was loaded
                animate_transformation = true;
                animate_duration = 400;
            });

        });

        function game_event_notification_handler(command_event) {
            /**
             * In case you have implemented game specific events, you can be notified of state changes
             *  the generic game logic (create, move, rotate etc.) has taken place already.
             */
            console.log("Application received command event:" + command_event);

            if (command_event['command'] == 'new_event') {
                var event_list_length = parseInt(command_event['parameters']['events']);

                // TODO: Load all events that the client has not yet seen, so could be load range or load single here!
                wasa_client.load_event(event_list_length);
            }
        }

        function game_event_handler(ge) {
            /**
             * WASA handles the basic stuff of chat, create, move, delete, rotate etc.
             *
             * But you could of course add game specific events here
             *
             */
            console.log("Application received event:" + JSON.stringify(ge));

            $('#game_board').addClass('board_flash_red');

            setTimeout(function () {
                $('#game_board').removeClass('board_flash_red');
            }, 300);

            if(ge['event_type'] == 'chat') {
                addChatMessage(ge);
            }
            else if (ge['event_type'] == 'create_component') {
                createAndAddComponentToGameBoard(ge);
            }
            else if (ge['event_type'] == 'move_component') {
                moveComponent(ge);
            }
            else if (ge['event_type'] == 'delete_component') {
                deleteComponent(ge);
            }
            else if (ge['event_type'] == 'rotate_component') {
                rotateComponent(ge);
            }
            else if (ge['event_type'] == 'rotate_component') {
                rotateComponent(ge);
            }
            else if (ge['event_type'] == 'mark_components') {
                markComponents(ge);
            }
            else if (ge['event_type'] == 'unmark_components') {
                unmarkComponents(ge);
            }
            else if (ge['event_type'] == 'dice_roll') {
                handleDiceRollEvent(ge);
            }
            else {
                console.error("Unhandled event type "+ge['event_type']);
            }
        }


    </script>

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Game lobby</h4>
                </div>
                <div class="modal-body">
                    <p>Enter an email address and password to protect your games. You can not change email and password without losing access yo your current games.</p>
                    <div class="row">
                        <div class="col-sm-9">
                            <form>
                              <div class="form-group">
                                <label for="exampleInputEmail1">Email address</label>
                                <input type="email" class="form-control" id="exampleInputEmail1" placeholder="Email">
                              </div>
                              <div class="form-group">
                                <label for="exampleInputPassword1">Password</label>
                                <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password">
                              </div>
                            </form>
                        </div>
                        <div class="col-sm-3" style="border-left: 1px solid grey; height: 100%;">
                            <button type="button" class="btn btn-sm btn-danger" onclick="wasa_client.reset_game();">Reset game</button>
                        </div>

                    </div>


                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <div id="pulled_header">
        <button type="button" class="btn btn-primary btn-sm pull-right" data-toggle="modal" data-target="#myModal">
            Game lobby
        </button>
        <h3 id="game_id_header" class=""> </h3>
    </div>
    <h2><a href=".."><<<</a>Red Winter <small>v0.1a</small></h2>
    <p>The Soviet Attack at Tolvaj√§rvi, Finland 1939</p>

    <div class="row">

        <div class="col-sm-3">

            <div class="alert alert-warning alert-dismissible" role="alert">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <strong>Note:</strong>
                <p>Game is still in <strong>alpha stage</strong> development and any game my be erased or appear buggy at times.</p>
            </div>

            <div class="alert alert-info alert-dismissible" role="alert">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <strong>Tips</strong>
                <ul>
                    <li>Use your browser zoom-tools! (Ctrl or ALT + plus/minus).</li>
                    <li>If on a touch-screen, Pan and Pinch zoom.</li>
                    <li>Drag components from the tray to the map.</li>
                    <li>Components moved will immediately be moved on all viewing game boards also.</li>
                    <li>Click to select a stack of components.</li>
                    <li>Click again on any selected component to inspect a stack. Click anywhere to dismiss inspection.</li>
                    <li>While inspecting, you can drag a component as from the component location.</li>
                </ul>
            </div>

            <div class="panel panel-default wasa_panel">

                <div class="panel-heading">
                    <h5>Events <small class="text-muted">(This panel is draggable!)</small></h5>
                    <span class="pull-right clickable"><i class="glyphicon glyphicon-chevron-up"></i></span>

                </div>
                <div class="panel-body">
                    <textarea id="events_textarea" class="form-control"></textarea>

                    <button type="button" class="btn btn-default" onclick="roll_D6()">Roll D6</button>
                    <button type="button" class="btn btn-default" onclick="roll_2D6()">Roll 2D6</button>

                    <input id="event_input" class="form-control" placeholder="Chat, comments, clarificatins or /help">
                </div>
            </div>

            <div class="panel panel-default wasa_panel resizable">

                <div class="panel-heading">
                    <h5>Counter tray <small class="text-muted">(This panel is draggable!)</small></h5>
                    <span class="pull-right clickable"><i class="glyphicon glyphicon-chevron-up"></i></span>

                </div>
                <div class="panel-body component_tray" id="main_tray">

                </div>
            </div>

        </div>
        <div class="col-sm-9">
            <div class="panel panel-default wasa_panel">
                <div class="panel-heading">Game Board <small class="text-muted">(This panel is draggable!)</small></div>
                <div class="panel-body">
                    <div id="game_board" class="ui-widget-header">
                        <div id="lineup_box">
                            <div class="cbox_holder">
                                <div class="cbox cb_unmark"></div>
                                <div class="cbox cb_mark cb_red"></div>
                                <div class="cbox cb_mark cb_green"></div>
                                <div class="cbox cb_mark cb_blue"></div>
                                <div class="cbox cb_mark cb_yellow"></div>
                                <div class="cbox cb_mark cb_pink"></div>
                                <div class="cbox cb_mark cb_cyan"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
